<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script type="text/javascript">
		var calcHistory = {};
		let replacements = {
			"log": "logBase",
			"E"  : "Math.E",
			"PI" : "Math.PI"
		}

		function logBase(base, val) {
			if (val) {
				return Math.log(val) / Math.log(base);
			}
			return Math.log(base);
		}

		function saveCalc() {
			calcHistory[Object.keys(calcHistory).length] = [document.getElementById("input").value, document.getElementById("output").value];
			reWriteHistory();
		}

		function reWriteHistory() {
			var historyNode = document.getElementById("history");
			if (historyNode) {
				document.body.removeChild(historyNode);
			}
			let div = document.createElement("div");
			div.id = "history";
			Object.keys(calcHistory).forEach(key => {
				let div2 = document.createElement("div");
				let arr = calcHistory[key];

				div2.innerText = (parseInt(key)+1) + ") Formula: " + arr[0] + "\t" + ", Result: " + arr[1];
				div.appendChild(div2);
			})
			document.body.appendChild(div);
		}

		function enterInputFunc(e) {
			 if (e.keyCode === 13) {
			    e.preventDefault();
			    document.getElementById("saveCalcButton").click();
		  }
		};

		function onChange(e) {
			try {
				var formula = e.target.value;
				var result = evalResult(formula);
				if (result === false) {
					return;
				}
				result = result || 0;
				if (typeof result === "number") {
					document.getElementById("output").value = parseInt(result) === result ? result : result.toFixed(3);
				}
			} catch(e) {
			}
		}

		function evalResult(formula) {
			try {
				Object.keys(replacements).forEach((key) => {formula = formula.replaceAll(key, replacements[key])});
				return eval(formula);
			} catch(e) {
				return false;
			}
		}

		function resetHistory() {
			calcHistory = {};
			reWriteHistory();
		}
	</script>
</head>
<body>
	<div>
		<label>input</label>
		<input id="input">
	</div>
	<div>
		<label>output</label>
		<input id="output" value=0>
	</div>
	<div>
		<button id="saveCalcButton">save</button>
		<button id="resetHistoryButton">reset</button>
	</div>

	<script type="text/javascript">
		document.getElementById("input").addEventListener("input", onChange);
		document.getElementById("saveCalcButton").addEventListener("click", saveCalc);
		document.getElementById("input").addEventListener("keyup", enterInputFunc);
		document.getElementById("output").addEventListener("keyup", enterInputFunc);
		document.getElementById("resetHistoryButton").addEventListener("click", resetHistory);
	</script>
</body>
</html>